# 工作日志

本实习项目基于 Unity 引擎实现。

## Day-1

使用瓦片地图简单绘制了场景，通过`Input System`完成了人物的基本控制（代码位于`PlayerControl`类），如左右移动、跳跃、翻转，并实现了基本的物理检测（位于`PhysicsCheck`类），添加了碰撞箱和地面接触判定，阻止人物在空中连续跳跃的情况，同时修改人物的材质（摩擦力设为 0）来防止卡在墙壁上。

## Day-2

利用碰撞箱的接触判定和触发器`Trigger`，实现了角色的受伤判定和血量扣除。使用`Animator`工具完成了移动、跳跃、攻击、受伤和死亡的动画效果，并通过 C#脚本编写了不同动画之间的切换条件，其中处理了一些细节问题，如受伤时角色会有闪烁效果，且在闪烁期间保持无敌，并且受伤时还会受到击退的效果。角色血量减为 0 后直接死亡，关闭碰撞箱，使角色死后掉出画面。初步实现了特殊平台的效果，如使用`Platform Effector 2D`实现单向平台，并将不同的平台分类为不同的瓦片地图，方便设置不同的属性，普通平台即`Tilemap`，单向平台即`OneWayPlatform`。

## Day-3

实现了陷阱平台的效果，当角色底部与陷阱平台顶部碰撞接触时，平台开始消失，关闭其碰撞箱，播放破坏动画，然后关闭`SpriteRender`组件实现消失，经过一小段时间重新出现，整个过程使用了协程的方法，从而达到延时消失和出现的效果。为方便编写不同种类的敌人，先创建了`Enemy`基类，并在子类`Slime`中实现了绿史莱姆的移动逻辑：向一个方向移动，同时使用`Physics2D.OverlapCircle`方法判定左右是否可通行，当遇到墙壁或悬崖则调转方向，调头的具体做法是修改`transform.localScale`值的正负。为了使判定区域可视化，还利用`Gizmos`绘制出相应的区域范围。在实际测试中，遇到了敌人碰到墙壁后卡在原地的情况，发现原因是调头时左右判定区域没有及时离开墙壁的碰撞箱，解决办法是修改与调转方向有关的函数参数，明确调头后的朝向。同时还存在细节问题，如史莱姆的移动不是连续的，所以通过`Animator`向动画帧中插入事件，在播放跳跃动画时执行移动方法，使其每行走一步就停顿一下。敌人身上挂载了`Attack`类，可以对接触到的人物造成伤害。

## Day-4

完成了敌人小蓝和小黑的实现，`BlueFly`类和`Black`类均继承自`Enemy`基类。将小蓝的`Rigidbody 2D`组件中的`Gravity Scale`设置为 0，从而达到飞行的效果。小黑不会触发陷阱平台，所以在陷阱平台的碰撞箱触发时，要先获取碰撞体身上的 bool 变量`ignoreTrap`，若为 true，则平台不会消失。当小黑遇到悬崖时，会执行跳跃相关的方法，获得向上的瞬时力，同时播放跳跃动画，从而跃过悬崖。实现了人物攻击射箭的逻辑，按下空格执行攻击方法时，会在角色面前生成箭矢，并给予箭矢初速度，箭矢下降过程中逐渐改变`transform.rotation`，达到箭头偏转的效果。箭矢上挂载了`Attack`类，使其可对接触到的敌人造成伤害。箭矢接触到墙壁后，会将`Rigidbody 2D`组件上的`Body Type`设置为`Static`，从而静止在墙壁上。

## Day-5

实现了箭矢射在墙壁上变成单向平台的效果，在箭矢上添加`Platform Effector 2D`组件，默认处于关闭状态，当箭矢与`Tilemap`发生接触时，激活该组件，从而变成单向平台。还为箭矢添加了消失动画，先设定一个时间阈值，当箭矢上的计时器超过该阈值时，会出现闪烁效果，并使用`Mathf.Pow`方法对闪烁频率进行平方加速，再与协程相配合，从而达到加快闪烁的效果。实现了击杀敌人掉落钱币，完善了钱币的动画，当人物与钱币的碰撞箱接触时，即为拾取。实现了四种 Buff 的效果：拾取回血 Buff 可使人物当前血量`currentHealth`+1，但不超过最大血量；拾取加速 Buff 可使人物当前速度`currentSpeed`翻倍，并利用协程在拾取 Buff 的一段时间后回到正常状态；拾取无敌 Buff 可使人物处于无敌状态，无敌时间倒计时结束后取消无敌状态；拾取飞行 Buff 会使`PlayerControl`中的 bool 变量`canFly`变为 true，这时只要离开地面，持续按住 w 键，即可获得向上的速度矢量，从而实现飞行。经过测试，发现飞行中存在人物卡在单向平台下方的问题，原因是穿过单向平台的一瞬间，物理检测机制会误认为处于地面（`PhysicsCheck.isGround`为 true），导致飞行被终止，解决办法是在飞行过程中暂时将`isGround`强制设为 false，直到飞行停止后再恢复检测。

## Day-6

制作了三个可玩关卡，初步实现场景的加载切换，场景加载的操作由`Scene Load Manager`类管理。学习了如何用`Addressables`可寻址资源系统进行场景等资源的加载。为方便管理，将人物和 UI 界面放置在一个独立的场景`Persistent`中，该场景在游戏中持续存在，因此每次切换场景只需加载关卡场景。学习了如何使用`ScriptableObject`类作为数据容器，跨场景的传递数据和事件方法，如创建`Scene Load EventSO`文件，负责管理场景加载相关的事件。使用 Cinemachine 工具创建了虚拟相机，实现了相机视角对人物的跟随，添加延时效果，并在场景边缘设置 Collider，名为`Bounds`，作为相机和角色的活动边界，当相机边框与`Bounds`接触时就会停止移动，当角色越过`Bounds`时就会传送至另一侧。实现了 Buff 的随机刷新，添加名为`Buff Spawner`的类，挂载在空物体上，负责在设定的范围内随机生成 Buff，并添加 Buff 数量限制和生成时间间隔。添加了各种音效和背景音乐，由`FX PlayAudio Event SO`文件处理音效播放相关的事件，`Audio Manager`类负责监听，当某个音效被触发，对应的片段`Audio Clip`即会作为参数传递给`Audio Manager`类进行播放。初步制作了 UI 界面，由`UI Manager`类负责管理，创建`Character Event SO`文件，通过事件的广播和监听，实现人物血量槽和 Buff 槽的更新。

## Day-7

完善了 UI 界面，制作了开始、暂停、过关菜单，为按钮图片添加`Button`组件，并在`Button`上注册相应的事件方法，实现特定功能。创建`Score Event SO`文件，在怪物和钱币上添加相应的事件广播，由`UI Manager`监听，实现分数的更新和记录。在场景中添加空物体`Teleport`，`Teleport`类用于检测剩余敌人数量，当敌人被消灭完时，会进行事件的广播，使过关菜单跳出。按下`Esc`可唤出暂停菜单，并将`Time.timeScale`设置为 0，实现暂停，点击 RESUME 按钮即可恢复。在编写代码的过程中，与场景加载有关的事件方法较多，逻辑比较复杂，理解起来有难度。使用`ScriptableObject`可以有效地跨对象、跨场景管理事件、传递参数，但学习起来有难度，需要花时间理解。完成基础功能后，继续在关卡中添加了一些机制，增加了弹簧，玩家走到上面会受到向上的瞬时力，弹簧播放相应的动画和音效。添加了掉落平台，实现方式与单向平台类似，只是改变了阻挡的方向。最后，使用`Addressables`进行打包。
