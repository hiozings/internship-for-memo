# 工作日志

本实习项目基于 Unity 引擎实现。

## Day-1

使用瓦片地图简单绘制了场景，通过`Input System`完成了人物的基本控制（代码位于`PlayerControl`类），如左右移动、跳跃、翻转，并实现了基本的物理检测（位于`PhysicsCheck`类），添加了碰撞箱和地面接触判定，阻止人物在空中连续跳跃的情况，同时修改人物的材质（摩擦力设为 0）来防止卡在墙壁上。

## Day-2

利用碰撞箱的接触判定和触发器`Trigger`，实现了角色的受伤判定和血量扣除。使用`Animator`工具完成了移动、跳跃、攻击、受伤和死亡的动画效果，并通过 C#脚本编写了不同动画之间的切换条件，其中处理了一些细节问题，如受伤时角色会有闪烁效果，且在闪烁期间保持无敌，并且受伤时还会受到击退的效果。角色血量减为 0 后直接死亡，关闭碰撞箱，使角色死后掉出画面。初步实现了特殊平台的效果，如使用`Platform Effector 2D`实现单向平台，并将不同的平台分类为不同的瓦片地图，方便设置不同的属性，普通平台即`Tilemap`，单向平台即`OneWayPlatform`。

## Day-3

实现了陷阱平台的效果，当角色底部与陷阱平台顶部碰撞接触时，平台开始消失，关闭其碰撞箱，播放破坏动画，然后关闭`SpriteRender`组件实现消失，经过一小段时间重新出现，整个过程使用了协程的方法，从而达到延时消失和出现的效果。为方便编写不同种类的敌人，先创建了`Enemy`基类，并在子类`Slime`中实现了绿史莱姆的移动逻辑：向一个方向移动，同时使用`Physics2D.OverlapCircle`方法判定左右是否可通行，当遇到墙壁或悬崖则调转方向，调头的具体做法是修改`transform.localScale`值的正负。为了使判定区域可视化，还利用`Gizmos`绘制出相应的区域范围。在实际测试中，遇到了敌人碰到墙壁后卡在原地的情况，发现原因是调头时左右判定区域没有及时离开墙壁的碰撞箱，解决办法是修改与调转方向有关的函数参数，明确调头后的朝向。同时还存在细节问题，如史莱姆的移动不是连续的，所以通过`Animator`向动画帧中插入事件，在播放跳跃动画时执行移动方法，使其每行走一步就停顿一下。敌人身上挂载了`Attack`类，可以对接触到的人物造成伤害。

## Day-4

完成了敌人小蓝和小黑的实现，`BlueFly`类和`Black`类均继承自`Enemy`基类。将小蓝的`Rigidbody 2D`组件中的`Gravity Scale`设置为 0，从而达到飞行的效果。小黑不会触发陷阱平台，所以在陷阱平台的碰撞箱触发时，要先获取碰撞体身上的 bool 变量`ignoreTrap`，若为 true，则平台不会消失。当小黑遇到悬崖时，会执行跳跃相关的方法，获得向上的瞬时力，同时播放跳跃动画，从而跃过悬崖。实现了人物攻击射箭的逻辑，按下空格执行攻击方法时，会在角色面前生成箭矢，并给予箭矢初速度，箭矢下降过程中逐渐改变`transform.rotation`，达到箭头偏转的效果。箭矢上挂载了`Attack`类，使其可对接触到的敌人造成伤害。箭矢接触到墙壁后，会将`Rigidbody 2D`组件上的`Body Type`设置为`Static`，从而静止在墙壁上。

## Day-5

实现了箭矢射在墙壁上变成单向平台的效果，在箭矢上添加`Platform Effector 2D`组件，默认处于关闭状态，当箭矢与`Tilemap`发生接触时，激活该组件，从而变成单向平台。还为箭矢添加了消失动画，先设定一个时间阈值，当箭矢上的计时器超过该阈值时，会出现闪烁效果，并使用`Mathf.Pow`方法对闪烁频率进行平方加速，再与协程相配合，从而达到加快闪烁的效果。实现了击杀敌人掉落钱币，完善了钱币的动画，当人物与钱币的碰撞箱接触时，即为拾取。实现了四种 Buff 的效果：拾取回血 Buff 可使人物当前血量`currentHealth`+1，但不超过最大血量；拾取加速 Buff 可使人物当前速度`currentSpeed`翻倍，并利用协程在拾取 Buff 的一段时间后回到正常状态；拾取无敌 Buff 可使人物处于无敌状态，无敌时间倒计时结束后取消无敌状态；拾取飞行 Buff 会使`PlayerControl`中的 bool 变量`canFly`变为 true，这时只要离开地面，持续按住 w 键，即可获得向上的速度矢量，从而实现飞行。经过测试，发现飞行中存在人物卡在单向平台下方的问题，原因是穿过单向平台的一瞬间，物理检测机制会误认为处于地面（`PhysicsCheck.isGround`为 true），导致飞行被终止，解决办法是在飞行过程中暂时将`isGround`强制设为 false，直到飞行停止后再恢复检测。
